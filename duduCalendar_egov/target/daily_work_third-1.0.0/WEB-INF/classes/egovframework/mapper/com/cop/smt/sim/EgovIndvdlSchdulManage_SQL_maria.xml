<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="IndvdlSchdulManage">

	<resultMap id="IndvdlSchdulManage" type="egovframework.dudu.calendar.dailywork.service.DuduWorkVO">
		<result property="schdulId" column="SCHDUL_ID"/>
		<result property="schdulSe" column="SCHDUL_SE"/>
		<result property="schdulDeptId" column="SCHDUL_DEPT_ID"/>
		<result property="schdulDeptName" column="SCHDUL_DEPT_NAME"/>

		<result property="schdulKindCode" column="SCHDUL_KND_CODE"/>
		<result property="schdulBgnde" column="SCHDUL_BGNDE"/>
		<result property="schdulEndde" column="SCHDUL_ENDDE"/>
		<result property="schdulNm" column="SCHDUL_NM"/>
		<result property="schdulCn" column="SCHDUL_CN"/>
		<result property="schdulIpcrCode" column="SCHDUL_IPCR_CODE"/>
		<result property="schdulChargerId" column="SCHDUL_CHARGER_ID"/>
		<result property="schdulChargerName" column="SCHDUL_CHARGER_NAME"/>

		<result property="frstRegisterPnttm" column="FRST_REGIST_PNTTM"/>
		<result property="lastUpdusrPnttm" column="LAST_UPDT_PNTTM"/>
		
		<result property="projectId" column="PROJECT_ID" />
	</resultMap>

	<!-- 팀 프로젝트 목록 -->
	<select id="selectTeamProjectList" parameterType="comDefaultVO" resultType="egovMap">
	    SELECT
	        PROJECT_NM,
	        PROJECT_PER,
	        PROJECT_DEPT_NAME
	    FROM project
	    WHERE PROJECT_DEPT_NAME = #{orgnztNm}
	    AND (INSTR(CONCAT(',', PROJECT_PER, ','), CONCAT(',', #{schdulChargerId}, ',')) > 0 OR PROJECT_PER = #{schdulChargerId})
	    ORDER BY PROJECT_ID DESC
	</select>
	
	<!-- 팀원 달력 일일 업무 표시 -->
	<select id="selectIndvdlSchdulManage" parameterType="comDefaultVO" resultType="egovMap">
		SELECT
			SCHDUL_ID,
			SCHDUL_SE,
			SCHDUL_DEPT_ID,
			SCHDUL_KND_CODE	SCHDUL_KIND_CODE,
			SCHDUL_BGNDE	SCHDUL_BGNDE,
			SCHDUL_ENDDE,
			SCHDUL_NM,
			SCHDUL_CN,
			SCHDUL_IPCR_CODE,
			SCHDUL_CHARGER_ID,
			FRST_REGIST_PNTTM FRST_REGISTER_PNTTM,
			LAST_UPDT_PNTTM
		FROM SCHDUL
		WHERE SCHDUL_CHARGER_ID = #{mberId}
		ORDER BY FRST_REGIST_PNTTM DESC
	</select>

	<!-- 일정 등록  -->
	<insert id="insertIndvdlSchdulManage">

		INSERT INTO SCHDUL(
			SCHDUL_ID,
		    SCHDUL_SE,
		    SCHDUL_DEPT_ID,
		    SCHDUL_KND_CODE,
		    SCHDUL_BGNDE,
		    SCHDUL_ENDDE,
		    SCHDUL_NM,
		    SCHDUL_CN,
		    SCHDUL_IPCR_CODE,
		    SCHDUL_CHARGER_ID,
		    FRST_REGIST_PNTTM,
		    LAST_UPDT_PNTTM,
		    PROJECT_ID
		) 
		SELECT
			next_sequence_value('schdul_id_sequence'),
		    #{schdulSe},
		    #{schdulDeptId},
		    #{schdulKindCode},
		    #{schdulBgnde},
		    #{schdulEndde},
		    #{schdulNm},
		    #{schdulCn},
		    #{schdulIpcrCode},
		    #{schdulChargerId},
		    sysdate(),
		    sysdate(),
		    #{projectId}
		FROM
		    user_tbl u
	    LIMIT 1
	</insert>
	
	<!-- 일일 업무 수정 폼(모달) -->
	<select id="selectIndvdlSchdulManageDetailVO" resultType="EgovMap">
		SELECT
			SCHDUL_ID,
			SCHDUL_NM,
			SCHDUL_CN,
			PROJECT_ID,
			SCHDUL_BGNDE,
			SCHDUL_ENDDE
		FROM SCHDUL
		WHERE SCHDUL_ID = #{schdulId}
		LIMIT 1
	</select>
	
	<!-- 일일 업무 수정 처리  -->
	<update id="updateIndvdlSchdulManage">
		UPDATE SCHDUL
		SET
			SCHDUL_BGNDE=#{schdulBgnde},
			SCHDUL_ENDDE=#{schdulEndde},
			SCHDUL_NM=#{schdulNm},
			SCHDUL_CN=#{schdulCn},
			LAST_UPDT_PNTTM = sysdate(),
			PROJECT_ID=#{projectId}
		WHERE SCHDUL_ID = #{schdulId}
	</update>
	
	<!-- 일일 업무 삭제  -->
	<delete id="deleteIndvdlSchdulManage">
			DELETE FROM SCHDUL WHERE SCHDUL_ID = #{schdulId}
	</delete>
	
	<!-- 팀원 일정 목록 보기 -->
	<select id="selectUserWorkList" parameterType="comDefaultVO" resultType="egovMap">
	    SELECT
	    	SCHDUL_ID,
	        SCHDUL_NM,
	        SCHDUL_CN,
	        PROJECT_ID,
	        SCHDUL_CHARGER_ID,
	        SCHDUL_DEPT_ID,
	        PROJECT_ID,
	        SCHDUL_BGNDE,
	        SCHDUL_ENDDE
	    FROM schdul
	    WHERE SCHDUL_DEPT_ID = #{orgnztNm}
	    AND SCHDUL_BGNDE = #{schdulBgnde}
	</select>

</mapper>