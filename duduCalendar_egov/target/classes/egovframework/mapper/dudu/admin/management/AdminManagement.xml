<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="manageDAO">
    
    <!-- 팀원 목록 -->
    <!-- <select id="selectMbManagement" resultType="egovMap">
    	SELECT * FROM user_tbl WHERE OFCPS_NUM = '2'
    </select> -->
    <select id="selectMbManagement" resultType="egovMap">
		SELECT * FROM user_tbl
        WHERE OFCPS_NUM = '2'
        <if test='sbscrbSttus != null and sbscrbSttus neq "0" and sbscrbSttus neq ""'>
            AND USER_STTUS_CODE LIKE  #{sbscrbSttus}
        </if>
        <if test="@egovframework.com.cmm.util.EgovMybaitsUtil@isNotEmpty(searchKeyword)">
        <if test="searchCondition == 0">AND
             RESEARCHER_ID LIKE #{searchKeyword}
        </if>
        <if test="searchCondition == 1">AND
             USER_NM LIKE '%' #{searchKeyword} '%'
        </if>
        </if>
        ORDER BY RESEARCHER_ID DESC
        LIMIT #{recordCountPerPage} OFFSET #{firstIndex}
    </select>

    <!-- 팀원 개수 -->
    <select id="selectMbManagementCnt" resultType="int">
        SELECT COUNT(1) totcnt
        FROM(
        SELECT *
        FROM    USER_TBL WHERE OFCPS_NUM = '2'
        ) A
	    WHERE 1=1
	        <if test='sbscrbSttus != null and sbscrbSttus neq "0" and sbscrbSttus neq ""'>
	            AND USER_STTUS_CODE LIKE  #{sbscrbSttus}
	        </if>
	        <if test="@egovframework.com.cmm.util.EgovMybaitsUtil@isNotEmpty(searchKeyword)">
	        <if test="searchCondition == 0">AND
	             RESEARCHER_ID LIKE #{searchKeyword}
	        </if>
	        <if test="searchCondition == 1">AND
	             USER_NM LIKE '%' #{searchKeyword} '%'
	        </if>
	        </if>
	</select>
	
	<!-- 팀원 가입 상태 변경 -->
    <update id="updateMber" parameterType="String">
        UPDATE user_tbl 
        SET USER_STTUS_CODE = 'P'
        WHERE RESEARCHER_ID=#{researcherId}
    </update>
    
    <!-- 팀원 삭제 -->
    <delete id="deleteMber">
	    DELETE FROM user_tbl 
	    WHERE RESEARCHER_ID=#{researcherId}
	</delete>
	
	<!-- 임시 비밀번호 발급 -->
    <update id="tempPassword">
		UPDATE user_tbl
		   SET password = #{password}
		     , CHG_PWD_LAST_PNTTM = sysdate()
		     , PERMIS_ID = 'T'
		 WHERE RESEARCHER_ID = #{id}
	</update>
	
	<!-- 팀장 목록 -->
    <select id="selectLeaderManagement" resultType="egovMap">
    	SELECT * FROM user_tbl WHERE OFCPS_NUM = '1'
    </select>
    
    <!-- 팀장 개수 -->
    <select id="selectLeaderManagementCnt" resultType="int">
        SELECT COUNT(1) totcnt
        FROM(
        SELECT *
        FROM    USER_TBL WHERE OFCPS_NUM = '1'
        ) A
	    WHERE 1=1
	        <if test='sbscrbSttus != null and sbscrbSttus neq "0" and sbscrbSttus neq ""'>
	            AND sttus LIKE  #{sbscrbSttus}
	        </if>
	        <if test="@egovframework.com.cmm.util.EgovMybaitsUtil@isNotEmpty(searchKeyword)">
	        <if test="searchCondition == 0">AND
	             userId LIKE #{searchKeyword}
	        </if>
	        <if test="searchCondition == 1">AND
	             userNm LIKE '%' #{searchKeyword} '%'
	        </if>
	        </if>
	</select>
	
	<!-- 팀장 등록 -->
    <update id="insertLeader">
            update user_tbl
    		set OFCPS_NUM = '1'
   		WHERE RESEARCHER_ID = #{id}
    </update>
    
    <!-- 팀장 삭제 -->
    <update id="deleteLeader">
    	update user_tbl
    		set OFCPS_NUM = '2'
   		WHERE RESEARCHER_ID = #{id}
    </update>

</mapper>